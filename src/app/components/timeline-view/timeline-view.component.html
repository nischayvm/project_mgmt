<div class="space-y-6">
  <div class="flex items-center justify-between">
    <h3 class="text-lg font-semibold text-white">Project Timeline</h3>
    <p class="text-sm text-white/60">
      {{ sortedProjects().length }} projects
    </p>
  </div>

  <!-- Main Timeline Bar (Horizontal) -->
  <div class="relative mb-8" style="height: 80px;">
    <!-- Background Timeline Line -->
    <div
      class="absolute left-0 top-10 h-1.5 w-full rounded-full bg-white/10"
    ></div>

    <!-- Project Timeline Bars (visual representation of duration) -->
    <div
      *ngFor="let project of sortedProjects()"
      class="group absolute top-9 h-3 rounded-full transition-all hover:opacity-100 hover:shadow-lg cursor-pointer z-10"
      [class]="
        project.status === 'approved' || project.status === 'completed'
          ? 'bg-green-500/60 hover:bg-green-500/80'
          : project.status === 'in_progress' || project.status === 'in_review'
          ? 'bg-blue-500/60 hover:bg-blue-500/80'
          : project.status === 'on_hold'
          ? 'bg-yellow-500/60 hover:bg-yellow-500/80'
          : project.status === 'cancelled' || project.status === 'rejected'
          ? 'bg-red-500/60 hover:bg-red-500/80'
          : 'bg-gray-500/60 hover:bg-gray-500/80'
      "
      [style.left.%]="getProjectPosition(project)"
      [style.width.%]="getProjectWidth(project)"
    >
      <!-- Hover Tooltip for Bar -->
      <div
        class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-20"
      >
        <div
          class="whitespace-nowrap rounded-lg bg-gray-900 px-3 py-2 text-xs text-white shadow-xl border border-white/20"
        >
          <div class="font-semibold">{{ project.projectName }}</div>
          <div class="text-white/60">
            {{ project.startDate | date : 'MMM d, y' }}
            <span *ngIf="project.endDate">
              - {{ project.endDate | date : 'MMM d, y' }}
            </span>
          </div>
          <div class="text-white/60">
            Duration: {{ getDurationDisplay(project) }}
          </div>
          <div class="text-white/60">Status: {{ project.status }}</div>
        </div>
        <!-- Tooltip Arrow -->
        <div
          class="absolute left-1/2 -translate-x-1/2 top-full h-0 w-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"
        ></div>
      </div>
    </div>

    <!-- Project Timeline Nodes (circles at start of each project) -->
    <div
      *ngFor="let project of sortedProjects()"
      class="group absolute top-10 left-0 transition-all hover:scale-125 hover:shadow-lg cursor-pointer z-10"
      [style.left.%]="getProjectPosition(project)"
      style="transform: translateX(-50%) translateY(-50%);"
    >
      <!-- Outer Ring -->
      <div
        class="h-5 w-5 rounded-full border-2 flex items-center justify-center"
        [class]="
          project.status === 'approved' || project.status === 'completed'
            ? 'border-green-500'
            : project.status === 'in_progress' || project.status === 'in_review'
            ? 'border-blue-500'
            : project.status === 'on_hold'
            ? 'border-yellow-500'
            : project.status === 'cancelled' || project.status === 'rejected'
            ? 'border-red-500'
            : 'border-gray-500'
        "
      >
        <!-- Inner Circle -->
        <div
          class="h-3 w-3 rounded-full"
          [class]="
            project.status === 'approved' || project.status === 'completed'
              ? 'bg-green-500/30'
              : project.status === 'in_progress' || project.status === 'in_review'
              ? 'bg-blue-500/30'
              : project.status === 'on_hold'
              ? 'bg-yellow-500/30'
              : project.status === 'cancelled' || project.status === 'rejected'
              ? 'bg-red-500/30'
              : 'bg-gray-500/30'
          "
        ></div>
      </div>
      <!-- Hover Tooltip for Node -->
      <div
        class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-20"
      >
        <div
          class="whitespace-nowrap rounded-lg bg-gray-900 px-3 py-2 text-xs text-white shadow-xl border border-white/20"
        >
          <div class="font-semibold">{{ project.projectName }}</div>
          <div class="text-white/60">
            Start: {{ project.startDate | date : 'MMM d, y' }}
          </div>
          <div class="text-white/60">Status: {{ project.status }}</div>
        </div>
        <!-- Tooltip Arrow -->
        <div
          class="absolute left-1/2 -translate-x-1/2 top-full h-0 w-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"
        ></div>
      </div>
    </div>

    <!-- Date Labels (optional - showing min and max dates) -->
    <div class="absolute left-0 top-0 text-xs text-white/40">
      {{ dateRange().min | date : 'MMM d, y' }}
    </div>
    <div class="absolute right-0 top-0 text-xs text-white/40">
      {{ dateRange().max | date : 'MMM d, y' }}
    </div>
  </div>

  <!-- Project Cards -->
  <div class="space-y-4">
    <div
      *ngFor="let project of sortedProjects(); let i = index"
      class="relative"
    >
      <!-- Project Card -->
      <div
        class="rounded-2xl border border-white/10 bg-white/5 p-4 backdrop-blur-xl transition-all hover:border-primary/50 hover:bg-white/10"
      >
        <div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between">
          <div class="flex-1">
            <div class="flex items-center gap-2">
              <h4
                [routerLink]="['/update-project', project.projectId]"
                class="cursor-pointer text-lg font-semibold text-white transition-colors hover:text-primary"
              >
                {{ project.projectName }}
              </h4>
              <span
                class="inline-flex rounded-full border px-2 py-0.5 text-xs font-medium"
                [class]="getStatusColor(project.status)"
              >
                {{ project.status }}
              </span>
            </div>
            <p class="mt-1 text-sm text-white/60">
              {{ project.clientName }}
            </p>
            
            <!-- Mini Timeline Bar for this project -->
            <div class="mt-3 relative h-2 w-full rounded-full bg-white/5 overflow-visible">
              <!-- Background line showing full date range -->
              <div class="absolute inset-0 bg-white/10 rounded-full"></div>
              <!-- This project's position and duration -->
              <div
                class="group/bar absolute h-full rounded-full transition-all cursor-pointer hover:opacity-80"
                [class]="
                  project.status === 'approved' || project.status === 'completed'
                    ? 'bg-green-500/60'
                    : project.status === 'in_progress' || project.status === 'in_review'
                    ? 'bg-blue-500/60'
                    : project.status === 'on_hold'
                    ? 'bg-yellow-500/60'
                    : project.status === 'cancelled' || project.status === 'rejected'
                    ? 'bg-red-500/60'
                    : 'bg-gray-500/60'
                "
                [style.left.%]="getProjectPosition(project)"
                [style.width.%]="getProjectWidth(project)"
              >
                <!-- Hover Tooltip for Bar -->
                <div
                  class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover/bar:block z-30"
                >
                  <div
                    class="whitespace-nowrap rounded-lg bg-gray-900 px-3 py-2 text-xs text-white shadow-xl border border-white/20"
                  >
                    <div class="font-semibold">{{ project.projectName }}</div>
                    <div class="text-white/60">
                      {{ project.startDate | date : 'MMM d, y' }}
                      <span *ngIf="project.endDate">
                        - {{ project.endDate | date : 'MMM d, y' }}
                      </span>
                    </div>
                    <div class="text-white/60">
                      Duration: {{ getDurationDisplay(project) }}
                    </div>
                    <div class="text-white/60">
                      Position: {{ (getProjectPosition(project) | number:'1.0-1') }}% on timeline
                    </div>
                  </div>
                  <!-- Tooltip Arrow -->
                  <div
                    class="absolute left-1/2 -translate-x-1/2 top-full h-0 w-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"
                  ></div>
                </div>
              </div>
              <!-- Start marker -->
              <div
                class="group/marker absolute top-1/2 -translate-y-1/2 h-3 w-3 -translate-x-1/2 rounded-full border-2 bg-background transition-all cursor-pointer hover:scale-125 z-20"
                [class]="
                  project.status === 'approved' || project.status === 'completed'
                    ? 'border-green-500'
                    : project.status === 'in_progress' || project.status === 'in_review'
                    ? 'border-blue-500'
                    : project.status === 'on_hold'
                    ? 'border-yellow-500'
                    : project.status === 'cancelled' || project.status === 'rejected'
                    ? 'border-red-500'
                    : 'border-gray-500'
                "
                [style.left.%]="getProjectPosition(project)"
              >
                <!-- Hover Tooltip for Marker -->
                <div
                  class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover/marker:block z-30"
                >
                  <div
                    class="whitespace-nowrap rounded-lg bg-gray-900 px-3 py-2 text-xs text-white shadow-xl border border-white/20"
                  >
                    <div class="font-semibold">{{ project.projectName }}</div>
                    <div class="text-white/60">
                      Start: {{ project.startDate | date : 'MMM d, y' }}
                    </div>
                    <div class="text-white/60">Status: {{ project.status }}</div>
                    <div class="text-white/60">
                      Timeline Position: {{ (getProjectPosition(project) | number:'1.0-1') }}%
                    </div>
                  </div>
                  <!-- Tooltip Arrow -->
                  <div
                    class="absolute left-1/2 -translate-x-1/2 top-full h-0 w-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"
                  ></div>
                </div>
              </div>
            </div>
            
            <div class="mt-2 flex flex-wrap gap-4 text-xs text-white/60">
              <span>
                Start: {{ project.startDate | date : 'MMM d, y' }}
              </span>
              <span *ngIf="project.endDate">
                End: {{ project.endDate | date : 'MMM d, y' }}
              </span>
              <span>
                Duration: {{ getDurationDisplay(project) }}
              </span>
            </div>
          </div>
          <div class="text-right text-sm">
            <p class="text-white/80">{{ project.leadName }}</p>
            <p class="text-white/60">{{ project.leadDepartment }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

