<div class="space-y-8 text-white/85">
  <section
    class="flex flex-col gap-4 rounded-[28px] border border-white/10 bg-white/5/70 px-6 py-6 shadow-[0_35px_90px_rgba(9,14,33,0.55)] backdrop-blur-xl sm:flex-row sm:items-center sm:justify-between"
  >
    <div class="w-full sm:max-w-sm">
      <label for="project-search" class="sr-only">Search projects</label>
      <div class="relative">
        <span
          class="pointer-events-none absolute inset-y-0 left-3 flex items-center text-white/50"
          aria-hidden="true"
          >üîç</span
        >
        <input
          id="project-search"
          type="search"
          placeholder="Search projects, clients, contact person‚Ä¶"
          class="w-full rounded-2xl border border-white/15 bg-white/5 px-10 py-3 text-sm text-white/80 shadow-inner shadow-slate-950/30 outline-none transition focus:border-primary/60 focus:bg-white/10 focus:text-white focus:shadow-[0_10px_30px_rgba(59,130,246,0.25)]"
          (input)="updateSearch($any($event.target).value)"
        />
      </div>
    </div>
    <div class="flex flex-wrap items-center gap-3">
      <div
        class="rounded-full border border-white/15 bg-white/5 px-4 py-2 text-xs font-medium text-white/60"
      >
        {{ filteredProjects().length }} of {{ projects().length }} projects
      </div>
      <button
        ubButton
        size="sm"
        class="bg-gradient-to-r from-sky-500 via-indigo-500 to-purple-500 text-white shadow-[0_20px_45px_rgba(14,116,244,0.35)]"
        (click)="startCreate()"
      >
        Add project
      </button>
      <a
        ubButton
        size="sm"
        variant="outline"
        class="border-white/20 bg-white/10 text-white/80 hover:border-white/40 hover:text-white"
        routerLink="/new-project"
      >
        Open full editor
      </a>
    </div>
  </section>

  <section
    *ngIf="showCreatePanel"
    class="rounded-[26px] border border-white/10 bg-white/5/80 p-6 shadow-[0_35px_90px_rgba(9,14,33,0.55)] backdrop-blur-xl"
  >
    <header class="mb-4 flex items-center justify-between">
      <div>
        <h2 class="text-lg font-semibold text-white">Create new project</h2>
        <p class="text-xs uppercase tracking-[0.3em] text-white/50">
          Track engagements from day one
        </p>
      </div>
      <button
        type="button"
        class="text-xs text-white/60 transition hover:text-white"
        (click)="showCreatePanel = false"
      >
        Cancel
      </button>
    </header>
    <form
      [formGroup]="projectForm"
      (ngSubmit)="onSave()"
      class="grid gap-4 md:grid-cols-2"
    >
      <div class="md:col-span-1">
        <label
          for="project-name"
          class="mb-2 block text-xs uppercase tracking-[0.35em] text-white/60"
          >Project name</label
        >
        <input
          id="project-name"
          type="text"
          formControlName="projectName"
          class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/80 outline-none transition focus:border-primary/60 focus:bg-white/10 focus:text-white"
          placeholder="Next-gen platform"
        />
      </div>
      <div class="md:col-span-1">
        <label
          for="client-name"
          class="mb-2 block text-xs uppercase tracking-[0.35em] text-white/60"
          >Client name</label
        >
        <input
          id="client-name"
          type="text"
          formControlName="clientName"
          class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/80 outline-none transition focus:border-primary/60 focus:bg-white/10 focus:text-white"
          placeholder="Acme Corp"
        />
      </div>
      <div class="md:col-span-1">
        <label
          for="start-date"
          class="mb-2 block text-xs uppercase tracking-[0.35em] text-white/60"
          >Start date</label
        >
        <input
          id="start-date"
          type="date"
          formControlName="startDate"
          class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/80 outline-none transition focus:border-primary/60 focus:bg-white/10 focus:text-white"
        />
      </div>
      <div class="md:col-span-1">
        <label
          for="contact-person"
          class="mb-2 block text-xs uppercase tracking-[0.35em] text-white/60"
          >Contact person</label
        >
        <input
          id="contact-person"
          type="text"
          formControlName="contactPerson"
          class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/80 outline-none transition focus:border-primary/60 focus:bg-white/10 focus:text-white"
          placeholder="Jane Smith"
        />
      </div>
      <div class="md:col-span-1">
        <label
          for="contact-no"
          class="mb-2 block text-xs uppercase tracking-[0.35em] text-white/60"
          >Contact number</label
        >
        <input
          id="contact-no"
          type="tel"
          formControlName="contactNo"
          class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/80 outline-none transition focus:border-primary/60 focus:bg-white/10 focus:text-white"
          placeholder="+1 (555) 123-9876"
        />
      </div>
      <div class="md:col-span-1">
        <label
          for="email-id"
          class="mb-2 block text-xs uppercase tracking-[0.35em] text-white/60"
          >Contact email</label
        >
        <input
          id="email-id"
          type="email"
          formControlName="emailId"
          class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/80 outline-none transition focus:border-primary/60 focus:bg-white/10 focus:text-white"
          placeholder="jane@client.com"
        />
      </div>
      <div class="md:col-span-2 flex justify-end gap-3 pt-2">
        <button
          type="submit"
          ubButton
          size="sm"
          class="bg-gradient-to-r from-emerald-500 via-green-500 to-lime-500 text-white shadow-[0_20px_45px_rgba(34,197,94,0.35)]"
        >
          Save project
        </button>
      </div>
    </form>
  </section>

  <section class="space-y-4">
    <div
      *ngFor="let project of filteredProjects()"
      class="overflow-hidden rounded-[26px] border border-white/10 bg-white/5/75 shadow-[0_30px_80px_rgba(10,15,35,0.5)] backdrop-blur-xl transition duration-200 hover:border-white/20"
    >
      <button
        type="button"
        class="flex w-full items-center justify-between gap-4 px-6 py-5 text-left text-sm text-white/80 transition hover:bg-white/5"
        (click)="toggleExpand(project.projectId)"
      >
        <div class="flex flex-1 flex-col gap-1 md:flex-row md:items-center">
          <span class="text-base font-semibold text-white">
            {{ project.projectName }}
          </span>
          <span
            class="mt-1 inline-flex rounded-full border border-white/15 bg-white/10 px-3 py-1 text-xs text-white/70 md:ml-4 md:mt-0"
          >
            {{ project.clientName }}
          </span>
        </div>
        <div class="flex items-center gap-3">
          <span class="text-xs text-white/60">
            {{ formattedDate(project.startDate) }}
          </span>
          <span
            class="text-xs uppercase tracking-[0.35em] text-white/40 transition"
            [class.text-white]="expandedProjectId === project.projectId"
          >
            {{ expandedProjectId === project.projectId ? "Hide" : "Details" }}
          </span>
        </div>
      </button>

      <div
        *ngIf="expandedProjectId === project.projectId"
        class="border-t border-white/10 px-6 py-6 text-sm text-white/75"
      >
        <ng-container
          *ngIf="editingProjectId === project.projectId; else projectView"
        >
          <form
            [formGroup]="projectForm"
            class="grid gap-4 md:grid-cols-2"
            (ngSubmit)="onSave()"
          >
            <div class="md:col-span-1">
              <label
                for="edit-project-name-{{ project.projectId }}"
                class="mb-2 block text-xs uppercase tracking-[0.3em] text-white/50"
                >Project name</label
              >
              <input
                [id]="'edit-project-name-' + project.projectId"
                type="text"
                formControlName="projectName"
                class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/90 outline-none transition focus:border-primary/60 focus:bg-white/10 focus:text-white"
              />
            </div>
            <div class="md:col-span-1">
              <label
                for="edit-client-{{ project.projectId }}"
                class="mb-2 block text-xs uppercase tracking-[0.3em] text-white/50"
                >Client name</label
              >
              <input
                [id]="'edit-client-' + project.projectId"
                type="text"
                formControlName="clientName"
                class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/90 outline-none transition focus:border-primary/60 focus:bg-white/10 focus:text-white"
              />
            </div>
            <div class="md:col-span-1">
              <label
                for="edit-start-{{ project.projectId }}"
                class="mb-2 block text-xs uppercase tracking-[0.3em] text-white/50"
                >Start date</label
              >
              <input
                [id]="'edit-start-' + project.projectId"
                type="date"
                formControlName="startDate"
                class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/90 outline-none transition focus:border-primary/60 focus:bg-white/10 focus:text-white"
              />
            </div>
            <div class="md:col-span-1">
              <label
                for="edit-contact-person-{{ project.projectId }}"
                class="mb-2 block text-xs uppercase tracking-[0.3em] text-white/50"
                >Contact person</label
              >
              <input
                [id]="'edit-contact-person-' + project.projectId"
                type="text"
                formControlName="contactPerson"
                class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/90 outline-none transition focus:border-primary/60 focus:bg-white/10 focus:text-white"
              />
            </div>
            <div class="md:col-span-1">
              <label
                for="edit-contact-no-{{ project.projectId }}"
                class="mb-2 block text-xs uppercase tracking-[0.3em] text-white/50"
                >Contact number</label
              >
              <input
                [id]="'edit-contact-no-' + project.projectId"
                type="tel"
                formControlName="contactNo"
                class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/90 outline-none transition focus:border-primary/60 focus:bg-white/10 focus:text-white"
              />
            </div>
            <div class="md:col-span-1">
              <label
                for="edit-email-{{ project.projectId }}"
                class="mb-2 block text-xs uppercase tracking-[0.3em] text-white/50"
                >Contact email</label
              >
              <input
                [id]="'edit-email-' + project.projectId"
                type="email"
                formControlName="emailId"
                class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/90 outline-none transition focus:border-primary/60 focus:bg-white/10 focus:text-white"
              />
            </div>
            <div class="md:col-span-2 flex justify-end gap-3 pt-2">
              <button
                type="button"
                class="rounded-xl border border-white/20 px-4 py-2 text-xs text-white/70 transition hover:border-white/40 hover:text-white"
                (click)="cancelEdit()"
              >
                Cancel
              </button>
              <button
                type="submit"
                ubButton
                size="sm"
                class="bg-gradient-to-r from-sky-500 via-indigo-500 to-purple-500 text-white shadow-[0_20px_45px_rgba(14,116,244,0.35)]"
              >
                Save changes
              </button>
            </div>
          </form>
        </ng-container>
        <ng-template #projectView>
          <div class="grid gap-4 sm:grid-cols-2">
            <div
              class="rounded-2xl border border-white/10 bg-white/5 px-4 py-3"
            >
              <p class="text-xs uppercase tracking-[0.3em] text-white/45">
                Client name
              </p>
              <p class="mt-1 text-base font-semibold text-white">
                {{ project.clientName }}
              </p>
            </div>
            <div
              class="rounded-2xl border border-white/10 bg-white/5 px-4 py-3"
            >
              <p class="text-xs uppercase tracking-[0.3em] text-white/45">
                Start date
              </p>
              <p class="mt-1 text-base font-semibold text-white">
                {{ formattedDate(project.startDate) }}
              </p>
            </div>
            <div
              class="rounded-2xl border border-white/10 bg-white/5 px-4 py-3"
            >
              <p class="text-xs uppercase tracking-[0.3em] text-white/45">
                Contact person
              </p>
              <p class="mt-1 text-base font-semibold text-white">
                {{ project.contactPerson || "‚Äî" }}
              </p>
            </div>
            <div
              class="rounded-2xl border border-white/10 bg-white/5 px-4 py-3"
            >
              <p class="text-xs uppercase tracking-[0.3em] text-white/45">
                Contact number
              </p>
              <p class="mt-1 text-base font-semibold text-white">
                {{ project.contactNo || "‚Äî" }}
              </p>
            </div>
            <div
              class="rounded-2xl border border-white/10 bg-white/5 px-4 py-3 sm:col-span-2"
            >
              <p class="text-xs uppercase tracking-[0.3em] text-white/45">
                Contact email
              </p>
              <p class="mt-1 text-base font-semibold text-white">
                {{ project.emailId || "‚Äî" }}
              </p>
            </div>
            <div class="sm:col-span-2 flex justify-end gap-3 pt-2">
              <a
                ubButton
                size="sm"
                variant="outline"
                class="border-white/20 bg-white/5 text-white/80 hover:border-white/40 hover:text-white"
                [routerLink]="['/update-project', project.projectId || 0]"
              >
                Full editor
              </a>
              <button
                type="button"
                class="rounded-xl border border-white/20 px-4 py-2 text-xs text-white/70 transition hover:border-white/40 hover:text-white"
                (click)="onEdit(project.projectId)"
              >
                Edit
              </button>
              <button
                type="button"
                class="rounded-xl border border-rose-400/40 bg-rose-500/10 px-4 py-2 text-xs text-rose-200 transition hover:border-rose-300/60 hover:bg-rose-500/20 hover:text-rose-100"
                (click)="onDelete(project.projectId)"
              >
                Delete
              </button>
            </div>
          </div>
        </ng-template>
      </div>
    </div>

    <div
      *ngIf="!filteredProjects().length"
      class="rounded-[26px] border border-dashed border-white/15 bg-white/5/60 px-6 py-12 text-center text-sm text-white/60 backdrop-blur-lg"
    >
      No projects match your filters.
    </div>
  </section>
</div>

<div
  *ngIf="pendingDelete as toDelete"
  class="fixed inset-0 z-[9999] flex items-center justify-center bg-slate-950/70 px-4"
>
  <div
    class="w-full max-w-md rounded-3xl border border-white/15 bg-gradient-to-br from-slate-900/95 via-slate-900/85 to-slate-900/95 p-6 text-sm text-white shadow-[0_40px_120px_rgba(9,9,16,0.65)]"
  >
    <h2 class="text-lg font-semibold text-white">
      Delete {{ toDelete.projectName }}?
    </h2>
    <p class="mt-2 text-white/70">
      This action cannot be undone. The project and its history will be removed.
    </p>
    <div class="mt-6 flex justify-end gap-3">
      <button
        type="button"
        class="rounded-xl border border-white/20 px-4 py-2 text-xs text-white/70 transition hover:border-white/40 hover:text-white"
        (click)="confirmDelete(false)"
      >
        Cancel
      </button>
      <button
        type="button"
        class="rounded-xl border border-rose-500/40 bg-rose-500/20 px-4 py-2 text-xs text-rose-100 shadow-[0_20px_45px_rgba(244,63,94,0.35)] transition hover:border-rose-400/60 hover:bg-rose-500/30"
        (click)="confirmDelete(true)"
      >
        Delete project
      </button>
    </div>
  </div>
</div>
